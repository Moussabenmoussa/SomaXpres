
{% extends "layout_dashboard.html" %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-6 pb-20"> <!-- Added pb-20 for mobile scroll space -->
    
    <!-- Header: Mobile Friendly -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
        <div>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h2>
            <p class="text-gray-500 mt-1 text-sm md:text-base">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØºØ±ÙØ© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©.</p>
        </div>
        <a href="/dashboard/products/new" class="w-full md:w-auto bg-black text-white px-5 py-3 rounded-xl text-sm font-bold hover:bg-gray-800 transition shadow-lg flex justify-center items-center gap-2">
            <i data-lucide="plus-circle" class="w-4 h-4"></i> Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
        </a>
    </div>

    <!-- 1. Stats Cards Grid (Responsive: 1 column on mobile, 4 on desktop) -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- Card 1: Revenue -->
        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden">
            <div class="flex justify-between items-start mb-2">
                <div class="p-2 bg-green-50 text-green-600 rounded-lg">
                    <i data-lucide="dollar-sign" class="w-5 h-5"></i>
                </div>
                <span class="text-[10px] font-bold text-green-600 bg-green-50 px-2 py-1 rounded-full">+12%</span>
            </div>
            <h3 class="text-gray-500 text-xs font-medium">Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</h3>
            <p class="text-2xl font-bold text-gray-900 mt-1">$1,240</p>
        </div>

        <!-- Card 2: Orders -->
        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
            <div class="flex justify-between items-start mb-2">
                <div class="p-2 bg-blue-50 text-blue-600 rounded-lg">
                    <i data-lucide="shopping-bag" class="w-5 h-5"></i>
                </div>
            </div>
            <h3 class="text-gray-500 text-xs font-medium">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¤ÙƒØ¯Ø©</h3>
            <p class="text-2xl font-bold text-gray-900 mt-1">{{ orders_count }}</p>
        </div>

        <!-- Card 3: Visits -->
        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
            <div class="flex justify-between items-start mb-2">
                <div class="p-2 bg-purple-50 text-purple-600 rounded-lg">
                    <i data-lucide="eye" class="w-5 h-5"></i>
                </div>
            </div>
            <h3 class="text-gray-500 text-xs font-medium">Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h3>
            <p class="text-2xl font-bold text-gray-900 mt-1">{{ total_views }}</p>
        </div>

        <!-- Card 4: Conversion -->
        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
            <div class="flex justify-between items-start mb-2">
                <div class="p-2 bg-orange-50 text-orange-600 rounded-lg">
                    <i data-lucide="activity" class="w-5 h-5"></i>
                </div>
            </div>
            <h3 class="text-gray-500 text-xs font-medium">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ (AI)</h3>
            <p class="text-2xl font-bold text-gray-900 mt-1">{{ conversion_rate }}%</p>
        </div>
    </div>

    <!-- 2. Charts & AI Feed Section (Stacked on mobile, Split on Desktop) -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- Main Chart -->
        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 lg:col-span-2">
            <h3 class="font-bold text-base mb-4">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡</h3>
            <div class="relative h-64 w-full">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>

        <!-- AI Activity Feed (Restored & Mobile Friendly) -->
        <div class="bg-black text-white p-5 rounded-2xl shadow-lg flex flex-col h-full min-h-[300px]">
            <h3 class="font-bold text-base mb-6 flex items-center gap-3">
                <span class="relative flex h-3 w-3">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                </span>
                AI Agent Live Feed
            </h3>
            
            <div class="space-y-6 text-sm text-gray-300 overflow-y-auto flex-1 custom-scrollbar">
                <!-- Activity 1 -->
                <div class="flex gap-3 items-start relative pl-4 border-r-2 border-green-500/50">
                    <div class="flex-1">
                        <p class="text-white font-medium text-xs mb-1">Amine <span class="text-green-400">closed a deal</span></p>
                        <p class="text-xs text-gray-400 leading-relaxed">Ù†Ø¬Ø­ ÙÙŠ Ø¥ØºÙ„Ø§Ù‚ ØµÙÙ‚Ø© Ø¨ÙŠØ¹ Ù…Ù†ØªØ¬ "Ø³Ø§Ø¹Ø© Ø£Ù„ØªØ±Ø§".</p>
                        <span class="text-[10px] text-gray-600 mt-2 block">Ù…Ù†Ø° Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ†</span>
                    </div>
                </div>

                <!-- Activity 2 -->
                <div class="flex gap-3 items-start relative pl-4 border-r-2 border-yellow-500/50">
                    <div class="flex-1">
                        <p class="text-white font-medium text-xs mb-1">Sarah <span class="text-yellow-400">negotiating</span></p>
                        <p class="text-xs text-gray-400 leading-relaxed">ØªØªÙØ§ÙˆØ¶ Ø§Ù„Ø¢Ù† Ù…Ø¹ Ø²Ø¨ÙˆÙ† Ù…Ù† ÙˆÙ‡Ø±Ø§Ù† Ø­ÙˆÙ„ Ø§Ù„Ø³Ø¹Ø±.</p>
                        <span class="text-[10px] text-gray-600 mt-2 block">Ø§Ù„Ø¢Ù†</span>
                    </div>
                </div>

                <!-- Activity 3 -->
                <div class="flex gap-3 items-start relative pl-4 border-r-2 border-red-500/50">
                    <div class="flex-1">
                        <p class="text-white font-medium text-xs mb-1">System <span class="text-red-400">rejected</span></p>
                        <p class="text-xs text-gray-400 leading-relaxed">Ø±ÙØ¶ Ø·Ù„Ø¨ Ù„Ø¹Ø¯Ù… Ø§ÙƒØªÙ…Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ.</p>
                        <span class="text-[10px] text-gray-600 mt-2 block">Ù…Ù†Ø° 10 Ø¯Ù‚Ø§Ø¦Ù‚</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. Recent Orders Table (Restored) -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50">
            <h3 class="font-bold text-base text-gray-800">ğŸ›’ Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
            <button class="text-xs text-blue-600 font-bold hover:underline">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
        </div>
        
        <!-- Mobile Scroll Wrapper -->
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-right whitespace-nowrap">
                <thead class="bg-gray-50 text-gray-500">
                    <tr>
                        <th class="px-6 py-4 font-medium text-xs uppercase tracking-wider">Ø§Ù„Ù…Ù†ØªØ¬</th>
                        <th class="px-6 py-4 font-medium text-xs uppercase tracking-wider">Ø§Ù„Ø²Ø¨ÙˆÙ†</th>
                        <th class="px-6 py-4 font-medium text-xs uppercase tracking-wider">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th class="px-6 py-4 font-medium text-xs uppercase tracking-wider">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    {% for order in recent_orders %}
                    <tr class="hover:bg-gray-50 transition">
                        <td class="px-6 py-4 font-medium text-gray-900">{{ order.product_name }}</td>
                        <td class="px-6 py-4 text-gray-600">{{ order.customer_phone or order.customer_email or 'ØºÙŠØ± Ù…ØªÙˆÙØ±' }}</td>
                        <td class="px-6 py-4">
                            <span class="bg-green-100 text-green-700 px-2 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide">
                                {{ order.status }}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-gray-400 text-xs">{{ order.created_at.strftime('%Y-%m-%d') if order.created_at else 'N/A' }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" class="px-6 py-10 text-center">
                            <div class="flex flex-col items-center justify-center text-gray-400">
                                <i data-lucide="shopping-cart" class="w-8 h-8 mb-2 opacity-20"></i>
                                <p class="text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- 4. My Products Table (Kept) -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="p-5 border-b border-gray-100 bg-gray-50/50">
            <h3 class="font-bold text-base text-gray-800">ğŸ“¦ Ù…Ù†ØªØ¬Ø§ØªÙŠ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©</h3>
        </div>
        
        <!-- Mobile Scroll Wrapper -->
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-right whitespace-nowrap">
                <thead class="bg-white text-gray-500 border-b">
                    <tr>
                        <th class="px-6 py-4 font-medium text-xs uppercase tracking-wider">Ø§Ù„Ù…Ù†ØªØ¬</th>
                        <th class="px-6 py-4 font-medium text-xs uppercase tracking-wider">Ø§Ù„Ø³Ø¹Ø±</th>
                        <th class="px-6 py-4 font-medium text-xs uppercase tracking-wider">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    {% for product in my_products %}
                    <tr class="hover:bg-gray-50 transition">
                        <td class="px-6 py-4 font-medium text-gray-900 flex items-center gap-3">
                            {% if product.images %}
                            <img src="{{ product.images[0] }}" class="w-10 h-10 rounded-lg object-cover bg-gray-100 border">
                            {% else %}
                            <div class="w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center text-gray-400 text-xs">No Img</div>
                            {% endif %}
                            <div class="flex flex-col">
                                <span>{{ product.name }}</span>
                                <span class="text-[10px] text-gray-400">{{ product.product_type }}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 font-bold">{{ product.price }} {{ product.currency_symbol }}</td>
                        <td class="px-6 py-4">
                            <a href="/p/{{ product._id }}" target="_blank" class="text-blue-600 hover:text-blue-800 text-xs font-bold flex items-center gap-1 w-fit bg-blue-50 px-3 py-1.5 rounded-lg transition-colors">
                                Ø¹Ø±Ø¶ <i data-lucide="external-link" class="w-3 h-3"></i>
                            </a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="3" class="px-6 py-8 text-center text-gray-400">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª. <a href="/dashboard/products/new" class="text-blue-600 underline">Ø£Ø¶Ù Ù…Ù†ØªØ¬Ùƒ Ø§Ù„Ø£ÙˆÙ„</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
    lucide.createIcons();

    // Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
    const ctx = document.getElementById('performanceChart').getContext('2d');
    const labels = {{ chart_data.labels | tojson }};
    const visitsData = {{ chart_data.visits | tojson }};
    const ordersData = {{ chart_data.orders | tojson }};

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª',
                    data: visitsData,
                    borderColor: '#9CA3AF',
                    backgroundColor: 'rgba(156, 163, 175, 0.1)',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 0
                },
                {
                    label: 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª',
                    data: ordersData,
                    borderColor: '#10B981', // Ø£Ø®Ø¶Ø±
                    backgroundColor: 'rgba(16, 185, 129, 0.05)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 2
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false } // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ
            },
            scales: {
                y: { beginAtZero: true, grid: { borderDash: [4, 4] } },
                x: { grid: { display: false } }
            }
        }
    });
</script>

<style>
    /* ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #333; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }
</style>
{% endblock %}
